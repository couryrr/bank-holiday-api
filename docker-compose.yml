version: "3.9"
services:
  bankholiday_redis:
    image: redis:6.2-alpine
    restart: unless-stopped
    ports:
      - "6379:6379"
  bankholiday_mysql:
    image: mysql:8.0
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: test1234
      MYSQL_DATABASE: bank_holiday
    ports:
      - "13306:3306"
  bankholiday_rabbitmq:
    image: rabbitmq:3-management
    restart: unless-stopped
    ports:
      - "15672:15672"
      - "5672:5672"
  bankholiday_application:
    depends_on:
      - bankholiday_mysql
      - bankholiday_redis
      - bankholiday_rabbitmq
    build:
      context: .
    restart: on-failure
    environment:
      SPRING_APPLICATION_JSON: '{
        "server.servlet.context-path":"/bank-holiday-api",
        "spring.datasource.url":"jdbc:mysql://bankholiday_mysql:3306/bank_holiday?useSSL=false&allowPublicKeyRetrieval=true",
        "spring.datasource.driver-class-name":"com.mysql.cj.jdbc.Driver",
        "spring.datasource.username": "root",
        "spring.datasource.password": "test1234",
        "spring.cache.type": "redis",
        "spring.redis.host":"bankholiday_redis",
        "spring.rabbitmq.host": "bankholiday_rabbitmq",
        "spring.rabbitmq.username": "guest",
        "spring.rabbitmq.password": "guest",
        "spring.rabbitmq.port": "5672"
      }'
    ports:
      - "8080:8080"

